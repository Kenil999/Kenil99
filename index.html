<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Prompt Enhancer – Ultra Fast AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- WebLLM runtime -->
<script src="https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm/dist/web-llm.min.js"></script>

<style>
body { font-family: Arial; padding: 20px; background: #fafafa; }
.box { background: white; padding: 15px; border-radius: 10px;
       box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
textarea { width: 100%; height: 140px; border: none; resize: none;
           outline: none; font-size: 16px; }
button { width: 100%; padding: 15px; background: black; color: white;
         border: none; border-radius: 10px; cursor: pointer;
         font-size: 18px; }
.hidden { display: none; }
</style>
</head>

<body>

<h2>AI Prompt Enhancer (Phi-3 Mini – Fast Mode)</h2>

<div class="box">
<textarea id="rawPrompt" placeholder="Type your raw prompt..."></textarea>
</div>

<button onclick="generateQuestions()">Refine Prompt</button>

<div id="questionsBox" class="box hidden"></div>
<div id="finalBox" class="box hidden"></div>

<script>
const SYSTEM_PROMPT = `
You are an Expert Prompt Engineer. You improve raw user prompts with
clarity, reasoning discipline, structure, and faithful intent preservation.

Your job:
1. Generate 3 clear refinement questions.
2. Then produce a structured optimized prompt:

STRUCTURED OPTIMIZED PROMPT
- AI Role
- Core Task
- Constraints
- Reasoning Instructions
- Output Format

KEY IMPROVEMENTS
(Bullet points)

Rules:
• Do not invent facts.
• Expand only when helpful.
• Preserve exact meaning.
• Keep language simple and powerful.
`;

let chat;

// Initialize Phi-3 Mini (VERY FAST)
(async () => {
    chat = await webllm.createChatSession("Phi-3-mini-4k-instruct-q4f16_1-MLC");
})();
  
async function runModel(prompt) {
    const reply = await chat.generate(prompt);
    return reply;
}

async function generateQuestions() {
    const raw = document.getElementById("rawPrompt").value.trim();
    if (!raw) return;

    document.getElementById("questionsBox").classList.remove("hidden");
    document.getElementById("questionsBox").innerHTML =
        "Loading model or thinking... (first run takes a few seconds)";

    const qPrompt = `${SYSTEM_PROMPT}

User raw prompt:
${raw}

TASK: Produce EXACTLY 3 refinement questions.`;

    const questions = await runModel(qPrompt);

    document.getElementById("questionsBox").innerHTML =
        `<strong>Clarification Questions:</strong><br><br>${questions.replace(/\n/g,'<br>')}`;

    generateFinal(raw, questions);
}

async function generateFinal(raw, questions) {
    document.getElementById("finalBox").classList.remove("hidden");
    document.getElementById("finalBox").innerHTML = "Optimizing prompt...";

    const fPrompt = `${SYSTEM_PROMPT}

RAW PROMPT:
${raw}

REFINEMENT QUESTIONS:
${questions}

TASK: Produce the full structured optimized prompt now.`;

    const finalOut = await runModel(fPrompt);

    document.getElementById("finalBox").innerHTML =
        `<strong>Optimized Prompt:</strong><br><br>${finalOut.replace(/\n/g,'<br>')}`;
}
</script>

</body>
</html>
